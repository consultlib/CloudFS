<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>lucid.crosstalk &mdash; Lucid v1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../../',
          VERSION:     '1.0',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: ''
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/interface.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="contents" title="Global table of contents" href="../../contents.html" />
    <link rel="index" title="Global index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="Lucid v1.0 documentation" href="../../index.html" />
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li><a href="../../index.html">Lucid v1.0 documentation</a> &raquo;</li>
      </ul>
    </div>
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  
  <div class="section" id="s-module-lucid.crosstalk">
<span id="s-dev-ref-crosstalk"></span><h1 id="module-lucid.crosstalk"><span id="dev-ref-crosstalk"></span>lucid.crosstalk<a class="headerlink" href="#module-lucid.crosstalk" title="Permalink to this headline">¶</a></h1>
<p>Lucid&#8217;s crosstalk system is similar to D-Bus; it provides a simple way for two application instances to communicate with one another. Lucid&#8217;s adaptation adds the ability to send and recieve messages between two different users as well. The api is influenced from Dojo&#8217;s <tt class="docutils literal"><span class="pre">dojo.subscribe</span></tt> and <tt class="docutils literal"><span class="pre">dojo.publish</span></tt> methods.</p>
<div class="section" id="s-lifecycle-of-a-message">
<h2 id="lifecycle-of-a-message">Lifecycle of a message<a class="headerlink" href="#lifecycle-of-a-message" title="Permalink to this headline">¶</a></h2>
<p>The way messages are sent depend on the destination, but the API acts the same either way. Each message sent can have a user, application, and instance as it&#8217;s destination. Both routes have a message dispacher that takes messages from a message queue and routes them to the other application. If the message only specifies an application, and the application is not running, then the dispacher will start the application and pass the message to it. If the message specifies a specific application instance, and that instance is not listening for messages, then the message is dropped.</p>
<div class="section" id="s-between-two-application-instances">
<h3 id="between-two-application-instances">Between two application instances<a class="headerlink" href="#between-two-application-instances" title="Permalink to this headline">¶</a></h3>
<img alt="Diagram of message flow between two applications" src="../../_images/crosstalk-one-user.png" />
<p>When done locally, the message is pushed into a message queue by the API to be processed by the dispacher.</p>
</div>
<div class="section" id="s-between-two-users">
<h3 id="between-two-users">Between two users<a class="headerlink" href="#between-two-users" title="Permalink to this headline">¶</a></h3>
<img alt="Diagram of message flow between two applications running under different users" src="../../_images/crosstalk-two-users.png" />
<p>In the event that the message specifies a different user then the current, the message is sent to the server. When the other person starts the desktop, and the message checker polls the server, then the message checker pushes the message into it&#8217;s message queue to be handled by the dispacher. The dispacher then sends the message to the application.</p>
</div>
</div>
<div class="section" id="s-topics-and-subscriptions">
<h2 id="topics-and-subscriptions">Topics and subscriptions<a class="headerlink" href="#topics-and-subscriptions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="s-topics">
<h3 id="topics">Topics<a class="headerlink" href="#topics" title="Permalink to this headline">¶</a></h3>
<p>Messages are separated into topics that can be subscribed to. For example, if you were writing a multiplayer checkers game, you could have a &#8220;movements&#8221; topic and a &#8220;chat&#8221; topic.</p>
</div>
<div class="section" id="s-subscribing">
<h3 id="subscribing">Subscribing<a class="headerlink" href="#subscribing" title="Permalink to this headline">¶</a></h3>
<p>When subscribing to topics, you provide a handler function. This function will handle any messages recieved by the dispacher.</p>
<p>It&#8217;s important that you subscribe to topics inside of the <tt class="docutils literal"><span class="pre">init</span></tt> method of your app, since the dispacher may launch your app to send it a message. If it does not find any subscriptions after the <tt class="docutils literal"><span class="pre">init</span></tt> method is called, then it will kill the app. Applications launched by the dispacher are passed a <tt class="docutils literal"><span class="pre">crosstalk</span></tt> argument, which is set to <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
<p>Subscribing to topics is pretty simple:</p>
<div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">myTopicSubscription</span> <span class="o">=</span> <span class="nx">lucid</span><span class="p">.</span><span class="nx">crosstalk</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s2">&quot;myTopic&quot;</span><span class="o">,</span> <span class="nx">dojo</span><span class="p">.</span><span class="nx">hitch</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="s2">&quot;myTopicHandler&quot;</span><span class="p">)</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">sysname</span><span class="p">);</span>
</pre></div>
<p>The dispacher will pass a single argument to the handler function, that will contain the message. Messages are always objects, their keys being specified by the application that sent it.</p>
<div class="highlight"><pre><span class="nx">myTopicHandler</span><span class="o">:</span> <span class="k">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">){</span>
    <span class="nx">lucid</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">someKey</span><span class="p">);</span>
<span class="p">}</span><span class="o">,</span>
</pre></div>
<p>Messages also have a <tt class="docutils literal"><span class="pre">_crosstalk</span></tt> property, that has information about where the message came from:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">topic</span></tt></dt>
<dd>The topic that the sender specified</dd>
<dt><tt class="docutils literal"><span class="pre">instance</span></tt></dt>
<dd>the instance that the sender specified</dd>
<dt><tt class="docutils literal"><span class="pre">appsysname</span></tt></dt>
<dd>the application's sysname that was specified by the sender</dd>
<dt><tt class="docutils literal"><span class="pre">sender</span></tt></dt>
<dd>the userID (not username) that the message originated from. This is <tt class="docutils literal"><span class="pre">null</span></tt> if it was sent locally.</dd>
</dl>
</div>
<div class="section" id="s-unsubscribing">
<h3 id="unsubscribing">Unsubscribing<a class="headerlink" href="#unsubscribing" title="Permalink to this headline">¶</a></h3>
<p>Unsubscribing from a topic will tell the dispacher to stop sending messages to the handler function:</p>
<div class="highlight"><pre><span class="nx">lucid</span><span class="p">.</span><span class="nx">crosstalk</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">myTopicSubscription</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="s-publishing-messages-to-topics">
<h2 id="publishing-messages-to-topics">Publishing messages to topics<a class="headerlink" href="#publishing-messages-to-topics" title="Permalink to this headline">¶</a></h2>
<p>To publish a message, use the <tt class="docutils literal"><span class="pre">publish</span></tt> method.</p>
<div class="section" id="s-publishing-messages-between-two-users">
<h3 id="publishing-messages-between-two-users">Publishing messages between two users<a class="headerlink" href="#publishing-messages-between-two-users" title="Permalink to this headline">¶</a></h3>
<p>To publish messages to a specific user, all you need to do is speicfy the userid and the app's system name, as well as the topic and message.</p>
<div class="highlight"><pre><span class="k">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">someKey</span><span class="o">:</span> <span class="s2">&quot;Some Value&quot;</span><span class="o">,</span>
    <span class="nx">foo</span><span class="o">:</span> <span class="s2">&quot;bar&quot;</span>
<span class="p">};</span>
<span class="k">var</span> <span class="nx">userid</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
<span class="nx">lucid</span><span class="p">.</span><span class="nx">crosstalk</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s2">&quot;myTopic&quot;</span><span class="o">,</span> <span class="nx">message</span><span class="o">,</span> <span class="nx">userid</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">sysname</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="s-publishing-messages-between-two-instances">
<h3 id="publishing-messages-between-two-instances">Publishing messages between two instances<a class="headerlink" href="#publishing-messages-between-two-instances" title="Permalink to this headline">¶</a></h3>
<p>To publish a message between two instances of an app being run by the same user, you need to pass <tt class="docutils literal"><span class="pre">null</span></tt> as the userid, and provide a system name and app instance.</p>
<div class="highlight"><pre><span class="k">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">someKey</span><span class="o">:</span> <span class="s2">&quot;Some Value&quot;</span><span class="o">,</span>
    <span class="nx">foo</span><span class="o">:</span> <span class="s2">&quot;bar&quot;</span>
<span class="p">};</span>
<span class="k">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
<span class="nx">lucid</span><span class="p">.</span><span class="nx">crosstalk</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s2">&quot;myTopic&quot;</span><span class="o">,</span> <span class="nx">message</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">sysname</span><span class="o">,</span> <span class="nx">instance</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="s-checking-if-a-message-is-on-the-database">
<h3 id="checking-if-a-message-is-on-the-database">Checking if a message is on the database<a class="headerlink" href="#checking-if-a-message-is-on-the-database" title="Permalink to this headline">¶</a></h3>
<p>This feature is handy if you want to check if the message has been sent to the user or not. If it has been sent, it will not exist on the database. You need to pass a event ID and a callback. The callback will be called with 'true' (it exists, not sent) or 'false' (it doesn't exist, sent).</p>
<pre>var message = {
    someKey: "Some Value",
    foo: "bar"
};
var instance = 2;
lucid.crosstalk.publish("myTopic", message, null, this.sysname, instance, dojo.hitch(this, function(id) {
     setTimeout(dojo.hitch(this, function() {
             lucid.crosstalk.exists(id, dojo.hitch(this, function(exists) {
                     if(exists) alert('event exists! message not yet sent');
                     else alert('event doesn't exist! message sent!');
             }));
     }), (lucid.config.crosstalkPing * 2));
}));</pre>
</div>
<div class="section" id="s-cancelling-an-event">
<h3 id="cancelling-an-event">Cancelling an event<a class="headerlink" href="#cancelling-an-event" title="Permalink to this headline">¶</a></h3>
<p>This is handy if you want an event sent to the user, but if the user isn't logged in or responding to crosstalk, it might as well be cancelled.</p>
<pre>var message = {
    someKey: "Some Value",
    foo: "bar"
};
var instance = 2;
lucid.crosstalk.publish("myTopic", message, null, this.sysname, instance, dojo.hitch(this, function(id) {
     setTimeout(dojo.hitch(this, function() {
             lucid.crosstalk.exists(id, dojo.hitch(this, function(exists) {
                     if(exists){
                             lucid.crosstalk.cancel(id);
                     }
                     else alert('event doesn't exist! message sent!');
             }));
     }), (lucid.config.crosstalkPing * 2));
}));</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3>Table Of Contents</h3>
            <ul>
<li><a class="reference" href="">lucid.crosstalk</a><ul>
<li><a class="reference" href="#lifecycle-of-a-message">Lifecycle of a message</a><ul>
<li><a class="reference" href="#between-two-application-instances">Between two application instances</a></li>
<li><a class="reference" href="#between-two-users">Between two users</a></li>
</ul>
</li>
<li><a class="reference" href="#topics-and-subscriptions">Topics and subscriptions</a><ul>
<li><a class="reference" href="#topics">Topics</a></li>
<li><a class="reference" href="#subscribing">Subscribing</a></li>
<li><a class="reference" href="#unsubscribing">Unsubscribing</a></li>
</ul>
</li>
<li><a class="reference" href="#publishing-messages-to-topics">Publishing messages to topics</a><ul>
<li><a class="reference" href="#publishing-messages-between-two-users">Publishing messages between two users</a></li>
<li><a class="reference" href="#publishing-messages-between-two-instances">Publishing messages between two instances</a></li>
<li><a class="reference" href="#checking-if-a-message-is-on-the-database">Checking if a message is on the database</a></li>
<li><a class="reference" href="#cancelling-an-event">Cancelling an event</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../_sources/dev/ref/crosstalk.txt">Show Source</a></li>
            </ul>
            <h3>Quick search</h3>
            <form class="search" action="../../search.html" method="get">
              <input type="text" name="q" size="18" /> <input type="submit" value="Go" />
              <input type="hidden" name="check_keywords" value="yes" />
              <input type="hidden" name="area" value="default" />
            </form>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li><a href="../../index.html">Lucid v1.0 documentation</a> &raquo;</li>
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright Dojo Foundation and Lucid Contributors.
      Last updated on May 31, 2009.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
    </div>
  </body>
</html>